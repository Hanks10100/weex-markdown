!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.WeexMarkdownComponent=t()}(this,function(){"use strict";function e(e){var t=l.exec(e);return t?{size:{width:parseInt(t[1],10)+"px",height:parseInt(t[2]||t[1],10)+"px"}}:{autosize:!0,size:{}}}function t(e,t){return e}function n(s,r,i,l){void 0===i&&(i=[]),void 0===l&&(l={});for(var c,h=!1,p=null;s;)if(c=o.escape.exec(s))s=s.substring(c[0].length);else{if(c=a.heading.exec(s)){s=s.substring(c[0].length),p="h"+c[1].length;var u=[];n(c[2],r,u,r[p]),u.length&&i.push({type:"span",style:r[p],children:u})}if(c=a.blockquote.exec(s)){s=s.substring(c[0].length),p="blockquote";var g=[];n(c[0].replace(/^>\s+/,"").replace(/[\n\t]>\s+/g,"\n"),r,g,r.blockquote),g.length&&i.push({type:"span",style:r.blockquote,children:g})}else if(c=o.image.exec(s)){s=s.substring(c[0].length),p="image";var d=e(c[1]);i.push({type:"image",style:Object.assign(d.size,r.image),attr:{resize:"contain",autosize:d.autosize,title:c[1],src:c[2]}})}else if(c=o.link.exec(s)){s=s.substring(c[0].length),h=!0;var f=[];n(c[1],r,f,Object.assign({},r.a,l)),f.length&&(p="a",i.push({type:"a",style:r.a,attr:{href:c[2]},children:f})),h=!1}else if(h||!(c=o.url.exec(s))){if(c=o.strong.exec(s)){s=s.substring(c[0].length);var x=[];n(c[2]||c[1],r,x),x.length&&i.push({type:"span",style:r.strong,children:x})}else if(c=o.em.exec(s)){s=s.substring(c[0].length);var m=[];n(c[2]||c[1],r,m),m.length&&i.push({type:"span",style:r.em,children:m})}else if(c=o.del.exec(s)){s=s.substring(c[0].length);var y=[];n(c[1],r,y,r.del),y.length&&i.push({type:"span",style:r.del,children:y})}else if(c=o.codespan.exec(s))s=s.substring(c[0].length),i.push({type:"span",attr:{value:" "}}),i.push({type:"span",style:Object.assign({},r.codespan,l),attr:{value:t(c[2],!0)}}),i.push({type:"span",attr:{value:" "}});else if(c=o.text.exec(s))s=s.substring(c[0].length),i.push({type:"span",style:Object.assign({},r.text,l),attr:{value:t(c[0])}});else if(s)throw new Error("Infinite loop on byte: "+s.charCodeAt(0))}else{s=s.substring(c[0].length);var b=t(c[1]);p="a",i.push({type:"a",style:r.a,attr:{href:b},children:[{type:"span",style:Object.assign({},r.text,r.a),attr:{value:b}}]})}}return p}function s(e,t){void 0===t&&(t={});var s=[];return{rootType:n(e,t,s),nodes:s}}function r(e){return e.split(h).map(function(e){return e})}function i(e,t,n){return void 0===n&&(n={}),Array.isArray(e)?e.map(function(e){var s=Object.assign({},n,e.style),r=i(e.children,t,e.style);switch(e.type){case"span":return t("span",{style:s},e.attr?e.attr.value:r);case"a":return t("html:a",{style:s,attrs:{href:e.attr.href}},r)}}):null}var a={heading:/^\n*(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,blockquote:/^ *>\s+([^\n]+)(\n(?!def)[^\n]+)*\n*/},o={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,image:/^!\[((?:\[[^\]]*\]|[^\[\]])*)\]\((https?:\/\/[^\s<]+[^<.,:;"')\]\s])(\s+\=[x\d]+)?\)/,link:/^\[((?:\[[^\]]*\]|[^\[\]])*)\]\((https?:\/\/[^\s<]+[^<.,:;"')\]\s])\)/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:[^_]|__)+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,codespan:/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:/^[\s\S]+?(?=[\\<!\[_*`~]|https?:\/\/| {2,}\n|$)/},l=/\{(\d+)x(\d+)?\}/i,c=function(e){return e.map(function(e){return e.children?c(e.children):e.text}).join("")},h=/[\n\t]{2,}/,p={a:{color:"#3333FF",textDecoration:"none"},codespan:{fontFamily:"monospace",fontSize:"32px",backgroundColor:"#E8E8E8",paddingLeft:"8px",paddingRight:"8px",marginLeft:"4px",marginRight:"4px",borderRadius:"6px"},del:{textDecoration:"line-through"},em:{fontStyle:"italic"},h1:{fontSize:"52px",textAlign:"center"},h2:{fontSize:"45px"},h3:{fontSize:"38px"},h4:{fontSize:"30px"},h5:{fontSize:"24px"},h6:{fontSize:"18px"},blockquote:{color:"#606060"},blockquoteBlock:{backgroundColor:"#F4F4F4",margin:"20px",padding:"15px",borderLeftWidth:"8px",borderLeftColor:"#BBB"},strong:{fontWeight:700},text:{fontSize:"32px"},imageBlock:{alignSelf:"center",marginTop:"20px",marginBottom:"20px"},h1Block:{alignSelf:"center",marginTop:"30px",marginBottom:"30px"},h2Block:{marginTop:"24px",marginBottom:"24px"},h3Block:{marginTop:"18px",marginBottom:"18px"},block:{color:"#333",marginTop:"12px",marginBottom:"12px"}},u={props:["autosize","src"],data:function(){return{width:750,height:200}},render:function(e){var t=this;return this.autosize?e("image",{style:{width:this.width,height:this.height},attrs:{src:this.src},on:{load:function(e){if(e.success){var n=e.size.naturalHeight/e.size.naturalWidth,s=Math.min(750,e.size.naturalWidth);t.width=s+"px",t.height=s*n+"px"}}}}):e("image",{attrs:{src:this.src}})}};return{name:"markdown",props:{content:String,theme:Object},methods:{getStyles:function(){var e=this;if(!this.theme)return p;var t={};for(var n in p)t[n]=Object.assign({},p[n],e.theme[n]);return t}},render:function(e){var t=this.content||c(this.$slots.default),n=this.getStyles();return e("div",{},r(t).map(function(t){var r=s(t,n),a=r.rootType,o=r.nodes,l=n.block;switch(a){case"image":return e(u,{style:Object.assign({},n.imageBlock,o[0].style),attrs:o[0].attr});case"blockquote":l=n.blockquoteBlock;break;case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":l=n[a+"Block"]}return"object"==typeof WXEnvironment&&"Web"===WXEnvironment.platform?e("p",{style:l},i(o,e)):e("richtext",{style:l,attrs:{value:o}})}))}}});
